<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pyspark/Data Analysis/window function">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Window function | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://highlander-spirou.github.io/second-documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://highlander-spirou.github.io/second-documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://highlander-spirou.github.io/second-documentation/docs/pyspark/Data Analysis/window function"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Window function | My Site"><meta data-rh="true" name="description" content="Window function là các action thực hiện row-wise thay vì column wise. Window function bao gồm các reader function (rank, denserank, rownumber) và các aggregation utilize các reader này"><meta data-rh="true" property="og:description" content="Window function là các action thực hiện row-wise thay vì column wise. Window function bao gồm các reader function (rank, denserank, rownumber) và các aggregation utilize các reader này"><link data-rh="true" rel="icon" href="/second-documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://highlander-spirou.github.io/second-documentation/docs/pyspark/Data Analysis/window function"><link data-rh="true" rel="alternate" href="https://highlander-spirou.github.io/second-documentation/docs/pyspark/Data Analysis/window function" hreflang="en"><link data-rh="true" rel="alternate" href="https://highlander-spirou.github.io/second-documentation/docs/pyspark/Data Analysis/window function" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IYWIXDU8QY-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/second-documentation/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/second-documentation/blog/atom.xml" title="My Site Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="My Site" href="/second-documentation/opensearch.xml"><link rel="stylesheet" href="/second-documentation/assets/css/styles.c6cba6cf.css">
<link rel="preload" href="/second-documentation/assets/js/runtime~main.489ed47c.js" as="script">
<link rel="preload" href="/second-documentation/assets/js/main.a92ee567.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/second-documentation/"><div class="navbar__logo"><img src="/second-documentation/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/second-documentation/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Shyn web</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/second-documentation/docs/category/sql">Tutorial</a><a class="navbar__item navbar__link" href="/second-documentation/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/highlander-spirou" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/second-documentation/docs/category/sql">SQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;SQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/second-documentation/docs/category/pyspark">Pyspark</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pyspark&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Install pyspark">Install Pyspark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Mô hình Spark">Mô hình hoạt động của pyspark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/RDD và DataFrame">RDD và DataFrame</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Quy tắc xử lí dữ liệu">Quy tắc xử lí dữ liệu</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/second-documentation/docs/category/data-analysis">Data Analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/Datetime">Datetime functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/Duplicate values">Duplicate values</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/Explode row">Explode row</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/Foward fill">Fill missing data from row</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/case when">Case when</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/concat">Concat (stack) dataframes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/groupby and agg">Groupby and Aggregation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/join">Join</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/melt">Melt dataframe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/udf">User defined function</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/second-documentation/docs/pyspark/Data Analysis/window function">Window function</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/second-documentation/docs/category/graphql">GraphQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;GraphQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/second-documentation/docs/intro">Tutorial Intro</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/second-documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/second-documentation/docs/category/pyspark"><span itemprop="name">Pyspark</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/second-documentation/docs/category/data-analysis"><span itemprop="name">Data Analysis</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Window function</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Window function</h1><p>Window function là các action thực hiện row-wise thay vì column wise. Window function bao gồm các reader function (<code>rank</code>, <code>dense_rank</code>, <code>row_number</code>) và các aggregation utilize các reader này</p><p>Để sử dụng reader function, cần define 1 cửa sổ</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Define window</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">window </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Window</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">partitionBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;col1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;col2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">desc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;col1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">asc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Using reader over window</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ranked </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">  df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;rank&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dense_rank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">over</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>trong đó, <code>rank</code>, <code>dense_rank</code> và <code>row_number</code> được coi là các tie-breaker giữa các dữ liệu giống nhau trong <code>orderBy</code> columns</p><ul><li><code>rank</code> sẽ đánh dấu các data bằng nhau bằng chung 1 rank, và shift các data đứng sau.<ul><li>rank array: <!-- -->[1,1,1,4,4,6]</li></ul></li><li><code>dense_rank</code> sẽ đánh dấu các data bằng nhau bằng chung 1 rank, và data đứng sau ko bị shift<ul><li>dense_rank array: <!-- -->[1,1,1,2,2,3]</li></ul></li><li><code>row_number</code> sẽ cứ đánh dấu tuần tự mặc dù các data bằng nhau<ul><li>row_number array: <!-- -->[1,2,3,4,5,6]</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dùng-aggregation-trên-reader-function">Dùng aggregation trên reader function<a href="#dùng-aggregation-trên-reader-function" class="hash-link" aria-label="Direct link to Dùng aggregation trên reader function" title="Direct link to Dùng aggregation trên reader function">​</a></h2><p>Ví dụ: Đề yêu cầu tính <em>balance per day</em> (cummulative sum)</p><p><img loading="lazy" alt="calculate_balance" src="data:image/png;base64,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" width="310" height="223" class="img_ev3q"></p><p>Lúc này, ta phải dùng kĩ thuật <strong><em>2 windows</em></strong>. Kĩ thuật này yêu cầu tạo 1 <code>ranked</code> column từ window 1, sau đó dùng aggregate function over window of ranked để cummulative sum </p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">w1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">partitionBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Account Number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Balance Date&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">asc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Balance&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">desc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">partitionBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Account Number&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">orderBy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rownum&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transactions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> transactions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;rownum&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">row_number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">over</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> transactions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">withColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;cumsum&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Balance&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">over</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">w2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/second-documentation/docs/pyspark/Data Analysis/udf"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">User defined function</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/second-documentation/docs/category/graphql"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GraphQL</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dùng-aggregation-trên-reader-function" class="table-of-contents__link toc-highlight">Dùng aggregation trên reader function</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/second-documentation/assets/js/runtime~main.489ed47c.js"></script>
<script src="/second-documentation/assets/js/main.a92ee567.js"></script>
</body>
</html>